# 食物嘌呤数据采集系统

## 功能概述

本系统实现了从 purinefood.com 网站自动采集食物嘌呤数据的功能，包括：

1. **网页数据解析** - 自动解析食物分类、名称、嘌呤含量和等级
2. **数据处理** - 标准化嘌呤等级分类和描述信息
3. **数据库集成** - 将处理后的数据自动导入到 Supabase 数据库
4. **API 接口** - 提供数据管理和查询的 RESTful API

## 系统架构

```
purinefood.com/zh/categories
├── 谷薯类及其制品 (112种食物)
├── 肉／水产类 (439种食物)
├── 蔬菜类 (153种食物)
├── 豆类及豆制品 (56种食物)
├── 水果类 (54种食物)
├── 硬／干果类 (42种食物)
├── 蛋／奶类 (25种食物)
├── 酒／饮料类 (6种食物)
├── 菇／菌类 (40种食物)
└── 其它 (117种食物)
```

## 数据结构

### 食物数据表 (food_library)

| 字段 | 类型 | 描述 |
|------|------|------|
| id | UUID | 主键 |
| name_cn | TEXT | 食物中文名称 |
| category | TEXT | 食物分类 |
| purine_level | TEXT | 嘌呤等级 (low/medium/high/very_high) |
| purine_mg | FLOAT8 | 嘌呤含量 (mg/100g) |
| description | TEXT | 食物描述和建议 |
| created_at | TIMESTAMP | 创建时间 |

### 嘌呤等级分类

- **低嘌呤 (low)**: < 25mg/100g - 适合痛风患者食用
- **中等嘌呤 (medium)**: 25-150mg/100g - 痛风患者需适量食用
- **高嘌呤 (high)**: 150-300mg/100g - 痛风患者应避免食用
- **极高嘌呤 (very_high)**: > 300mg/100g - 痛风患者绝对禁止食用

## 使用方法

### 1. 数据采集脚本

```bash
# 采集谷薯类数据
node scripts/collect-food-data.js

# 采集所有分类数据
node scripts/collect-all-categories.js

# 执行SQL导入数据库
node scripts/execute-sql.js
```

### 2. API 接口使用

#### 获取统计信息
```bash
curl http://localhost:3000/api/collect-food-data
```

#### 导入数据
```bash
curl -X POST http://localhost:3000/api/collect-food-data \
  -H "Content-Type: application/json" \
  -d '{"action": "collect"}'
```

#### 查看数据列表
```bash
curl -X POST http://localhost:3000/api/collect-food-data \
  -H "Content-Type: application/json" \
  -d '{"action": "list"}'
```

### 3. 手动数据导入

1. 运行采集脚本生成数据文件
2. 连接到 Supabase 数据库
3. 执行生成的 SQL 文件：
   ```sql
   -- 例如：执行 sql/insert-all-categories-data.sql
   ```

## 数据统计

### 当前数据量 (示例)
- **总计**: 178 个食物数据
- **低嘌呤**: 119 个 (66.9%)
- **中等嘌呤**: 36 个 (20.2%)
- **高嘌呤**: 19 个 (10.7%)
- **极高嘌呤**: 4 个 (2.2%)

### 分类分布
- 谷薯类及其制品: 112 个
- 肉／水产类: 10 个
- 蔬菜类: 10 个
- 豆类及豆制品: 10 个
- 水果类: 10 个
- 硬／干果类: 10 个
- 蛋／奶类: 10 个
- 酒／饮料类: 6 个

## 扩展功能

### 1. 完整网页抓取

如需实现完整的网页数据抓取，可以使用以下方法：

```javascript
// 使用 Playwright 进行网页抓取
const { chromium } = require('playwright');

async function scrapeAllCategories() {
  const browser = await chromium.launch();
  const page = await browser.newPage();

  // 访问分类页面
  await page.goto('https://purinefood.com/zh/categories');

  // 获取所有分类链接
  const categories = await page.$$eval('a[href^="/zh/categories/"]', links =>
    links.map(link => ({
      name: link.textContent,
      url: link.href
    }))
  );

  // 逐个分类抓取数据
  for (const category of categories) {
    await page.goto(category.url);
    // 解析页面数据...
  }

  await browser.close();
}
```

### 2. 定时数据更新

```javascript
// 设置定时任务定期更新数据
const cron = require('node-cron');

cron.schedule('0 2 * * 0', () => {
  console.log('开始定期更新食物嘌呤数据...');
  // 执行数据采集和更新逻辑
});
```

### 3. 数据验证和清洗

```javascript
// 添加数据验证逻辑
function validateFoodData(food) {
  if (!food.name_cn || food.name_cn.trim() === '') {
    throw new Error('食物名称不能为空');
  }

  if (food.purine_mg < 0 || food.purine_mg > 2000) {
    throw new Error('嘌呤含量值异常');
  }

  return true;
}
```

## 注意事项

1. **数据准确性**: 网站数据可能存在更新，建议定期同步
2. **法律合规**: 请确保遵守目标网站的robots.txt和使用条款
3. **性能优化**: 大量数据导入时建议分批处理
4. **错误处理**: 网络请求和数据库操作都需要适当的错误处理

## 文件结构

```
项目根目录/
├── lib/
│   └── food-data-collector.js    # 数据采集核心类
├── scripts/
│   ├── collect-food-data.js      # 单分类数据采集
│   ├── collect-all-categories.js # 全分类数据采集
│   └── execute-sql.js           # SQL执行脚本
├── data/
│   ├── raw-food-data.json        # 原始数据
│   └── processed-food-data.json  # 处理后数据
├── sql/
│   └── insert-all-categories-data.sql # 导入SQL
├── app/api/collect-food-data/
│   └── route.ts                 # API接口
└── docs/
    └── 食物数据采集说明.md       # 本文档
```

## 联系方式

如有问题或建议，请联系开发团队。